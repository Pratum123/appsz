<!-- тЬЕ Updated index.html with GitHub Gist Sync (canvas me nhi chahiye) -->
<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>ЁЯУШ рд╡рд┐рд╖рдп рдЪрдпрди</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f6fb;
      margin: 0;
      padding: 0;
    }
    header {
      background: #3949ab;
      color: white;
      padding: 20px;
      font-size: 24px;
      text-align: center;
    }
    .container {
      max-width: 500px;
      margin: 30px auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: #3949ab;
      font-size: 22px;
    }
    select, input, button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
    }
    .btn {
      background: #3949ab;
      color: white;
      font-weight: bold;
      border: none;
      cursor: pointer;
    }
    .section {
      margin-bottom: 30px;
    }
    h3 {
      font-size: 18px;
      color: #333;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

<header>ЁЯУШ Quiz App</header>

<div class="container">
  <h1>ЁЯУШ рд╡рд┐рд╖рдп рдФрд░ рдЙрдкрд╡рд┐рд╖рдп рдЪрдпрди</h1>

  <!-- рд╡рд┐рд╖рдп рдЪрдпрди -->
  <div class="section">
    <label><strong>рдореБрдЦреНрдп рд╡рд┐рд╖рдп:</strong></label>
    <select id="mainSubject" onchange="populateSubSubjects()">
      <option value="">-- рд╡рд┐рд╖рдп рдЪреБрдиреЗрдВ --</option>
    </select>
    <label><strong>рдЙрдкрд╡рд┐рд╖рдп:</strong></label>
    <select id="subSubject">
      <option value="">-- рдЙрдкрд╡рд┐рд╖рдп рдЪреБрдиреЗрдВ --</option>
    </select>
    <button class="btn" onclick="proceedToAction()">ЁЯСЙ рдЖрдЧреЗ рдмрдврд╝реЗрдВ</button>
  </div>

  <!-- рдирдпрд╛ рд╡рд┐рд╖рдп рдЬреЛрдбрд╝реЗрдВ -->
  <div class="section">
    <h3>тЮХ рдирдпрд╛ рд╡рд┐рд╖рдп рдЬреЛрдбрд╝реЗрдВ</h3>
    <input id="newMain" placeholder="рдореБрдЦреНрдп рд╡рд┐рд╖рдп (рдЬреИрд╕реЗ: Economics)">
    <input id="newSubs" placeholder="рдЙрдкрд╡рд┐рд╖рдп (рдХреЙрдорд╛ рд╕реЗ рдЕрд▓рдЧ рдХрд░реЗрдВ)">
    <button class="btn" onclick="addNewSubject()">ЁЯТ╛ рдЬреЛрдбрд╝реЗрдВ</button>
  </div>

  <!-- рдЙрдкрд╡рд┐рд╖рдп рдкреНрд░рдмрдВрдзрди -->
  <div class="section">
    <h3>ЁЯЫая╕П рдЙрдкрд╡рд┐рд╖рдп рдкреНрд░рдмрдВрдзрди</h3>
    <select id="manageMain" onchange="populateSubList()">
      <option value="">-- рд╡рд┐рд╖рдп рдЪреБрдиреЗрдВ --</option>
    </select>
    <select id="subList"></select>
    <button class="btn" onclick="deleteSub()">ЁЯЧСя╕П рдЙрдкрд╡рд┐рд╖рдп рд╣рдЯрд╛рдПрдВ</button>
  </div>

  <!-- GitHub Gist Sync -->
  <div class="section">
    <h3>тШБя╕П GitHub Gist Sync</h3>
    <input id="gistToken" placeholder="ЁЯФС GitHub Token">
    <button class="btn" onclick="saveToken()">ЁЯФР Token рд╕реЗрд╡ рдХрд░реЗрдВ</button>
    <button class="btn" onclick="exportToGist()">ЁЯТ╛ Gist рдореЗрдВ рд╕реЗрд╡ рдХрд░реЗрдВ</button>
    <input id="gistIdInput" placeholder="ЁЯФЧ Gist ID рдбрд╛рд▓реЗрдВ">
    <button class="btn" onclick="importFromGist()">ЁЯУе Gist рд╕реЗ рд▓реЛрдб рдХрд░реЗрдВ</button>
  </div>
</div>

<script>
const subjects = JSON.parse(localStorage.getItem("quiz_subjects") || "{}");

function capitalize(str) {
  return str.charAt(0).toUpperCase() + str.slice(1);
}

function populateDropdowns() {
  const main = document.getElementById("mainSubject");
  const manage = document.getElementById("manageMain");
  main.innerHTML = '<option value="">-- рд╡рд┐рд╖рдп рдЪреБрдиреЗрдВ --</option>';
  manage.innerHTML = '<option value="">-- рд╡рд┐рд╖рдп рдЪреБрдиреЗрдВ --</option>';

  for (let key in subjects) {
    const opt1 = new Option(capitalize(key), key);
    const opt2 = new Option(capitalize(key), key);
    main.appendChild(opt1);
    manage.appendChild(opt2);
  }
}

function populateSubSubjects() {
  const subject = document.getElementById("mainSubject").value;
  const subs = subjects[subject] || [];
  const subSelect = document.getElementById("subSubject");
  subSelect.innerHTML = '<option value="">-- рдЙрдкрд╡рд┐рд╖рдп рдЪреБрдиреЗрдВ --</option>';
  subs.forEach(sub => {
    subSelect.appendChild(new Option(sub, sub));
  });
}

function addNewSubject() {
  const newMain = document.getElementById("newMain").value.trim().toLowerCase();
  const newSubs = document.getElementById("newSubs").value.split(',').map(s => s.trim()).filter(Boolean);
  if (!newMain || newSubs.length === 0) {
    alert("тЭЧ рдХреГрдкрдпрд╛ рд╡рд┐рд╖рдп рдФрд░ рдЙрдкрд╡рд┐рд╖рдп рднрд░реЗрдВ");
    return;
  }
  subjects[newMain] = newSubs;
  localStorage.setItem("quiz_subjects", JSON.stringify(subjects));
  document.getElementById("newMain").value = "";
  document.getElementById("newSubs").value = "";
  populateDropdowns();
  alert("тЬЕ рдирдпрд╛ рд╡рд┐рд╖рдп рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛!");
}

function populateSubList() {
  const selected = document.getElementById("manageMain").value;
  const list = document.getElementById("subList");
  list.innerHTML = "";
  if (subjects[selected]) {
    subjects[selected].forEach(sub => {
      list.appendChild(new Option(sub, sub));
    });
  }
}

function deleteSub() {
  const subject = document.getElementById("manageMain").value;
  const sub = document.getElementById("subList").value;
  if (subject && sub) {
    subjects[subject] = subjects[subject].filter(s => s !== sub);
    localStorage.setItem("quiz_subjects", JSON.stringify(subjects));
    populateSubList();
    populateSubSubjects();
    alert("ЁЯЧСя╕П рдЙрдкрд╡рд┐рд╖рдп рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЧрдпрд╛!");
  }
}

function proceedToAction() {
  const main = document.getElementById("mainSubject").value;
  const sub = document.getElementById("subSubject").value;
  if (!main || !sub) {
    alert("тЪая╕П рдХреГрдкрдпрд╛ рд╡рд┐рд╖рдп рдФрд░ рдЙрдкрд╡рд┐рд╖рдп рдЪреБрдиреЗрдВ!");
    return;
  }
  localStorage.setItem("selectedMain", main);
  localStorage.setItem("selectedSub", sub);
  window.location.href = "action.html";
}

function saveToken() {
  const token = document.getElementById("gistToken").value.trim();
  if (!token) {
    alert("тЭЧ рдХреГрдкрдпрд╛ GitHub Token рджрд░реНрдЬ рдХрд░реЗрдВ");
    return;
  }
  localStorage.setItem("gist_token", token);
  alert("тЬЕ Token рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛");
}

async function exportToGist() {
  const token = localStorage.getItem("gist_token");
  if (!token) {
    alert("тЭЧ рдкрд╣рд▓реЗ GitHub Token рд╕реЗрд╡ рдХрд░реЗрдВ");
    return;
  }
  const data = {
    subjects,
    main: localStorage.getItem("selectedMain"),
    sub: localStorage.getItem("selectedSub"),
    quizData: {}
  };
  for (let key in localStorage) {
    if (key.startsWith("quiz_")) {
      data.quizData[key] = JSON.parse(localStorage.getItem(key));
    }
  }
  const body = {
    description: "Quiz App Backup",
    public: false,
    files: {
      "quiz_backup.json": {
        content: JSON.stringify(data, null, 2)
      }
    }
  };
  const res = await fetch("https://api.github.com/gists", {
    method: "POST",
    headers: {
      "Authorization": `Bearer ${token}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify(body)
  });
  const result = await res.json();
  if (result.id) {
    prompt("тЬЕ Gist рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдмрдирд╛!\nрдпрд╣ ID рд╕реЗрд╡ рдХрд░реЗрдВ:", result.id);
  } else {
    alert("тЭМ Gist рд╕реЗрд╡ рдирд╣реАрдВ рд╣реЛ рдкрд╛рдпрд╛");
  }
}

async function importFromGist() {
  const gistId = document.getElementById("gistIdInput").value.trim();
  if (!gistId) {
    alert("тЭЧ рдХреГрдкрдпрд╛ Gist ID рджрд░реНрдЬ рдХрд░реЗрдВ");
    return;
  }
  const res = await fetch(`https://api.github.com/gists/${gistId}`);
  const gist = await res.json();
  const content = gist.files["quiz_backup.json"].content;
  const data = JSON.parse(content);
  if (data.subjects) localStorage.setItem("quiz_subjects", JSON.stringify(data.subjects));
  if (data.main) localStorage.setItem("selectedMain", data.main);
  if (data.sub) localStorage.setItem("selectedSub", data.sub);
  if (data.quizData) {
    for (let key in data.quizData) {
      localStorage.setItem(key, JSON.stringify(data.quizData[key]));
    }
  }
  alert("тЬЕ Gist рдбреЗрдЯрд╛ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рд▓реЛрдб рд╣реБрдЖ!");
  location.reload();
}

window.onload = populateDropdowns;
</script>

</body>
</html>
